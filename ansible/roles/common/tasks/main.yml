---
- name: Update apt cache
  apt:
    update_cache: yes
    cache_valid_time: 3600
  become: yes

- name: Install basic packages
  apt:
    name:
      - zsh
      - git
      - lsd
      - grc
      - tmux
      - direnv
      - fzf
      - fd-find
      - ripgrep
      - neovim
      - ruby-neovim
      - python3-pynvim
      - ghc
      - cabal-install
      - firmware-ti-connectivity
      - tealdeer
      - python3
      - python3-pip
      - nodejs
      - npm
      - ca-certificates
      - curl
      - socat
    state: present
  become: yes

- name: Install uv (Python package manager)
  shell: curl -LsSf https://astral.sh/uv/install.sh | sh
  args:
    creates: ~/.cargo/bin/uv
  become_user: "{{ ansible_user }}"

- name: Configure sudoers for debian user (no password)
  copy:
    content: "debian ALL=(ALL) NOPASSWD: ALL\n"
    dest: /etc/sudoers.d/debian-nopasswd
    mode: '0440'
    validate: 'visudo -cf %s'
  become: yes

- name: Install Kitty terminfo
  shell: tic -x {{ playbook_dir }}/assets/xterm-kitty.terminfo
  args:
    creates: ~/.terminfo/x/xterm-kitty
  become_user: "{{ ansible_user }}"
